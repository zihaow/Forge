<?xml version="1.0" encoding="UTF-8"?>

<!-- This build file must be placed under the /src folder.
     And the test cases must be in /src/test. 
     @Author: Zihao Wu, Xuefei Yang
-->

<project name="Minecraft" basedir="." default="main">

    
    <property name="src.dir"  value="src"/>
    <property name="MinecraftForgeVersion" value="1.7.2"/>
    <property name="src.main" value="src/main/java"/>
    <property name="src.resources" value="src/main/resources" />
    <property name="src.test" value="src/main/test" />
    <property name="src.minecraft" value="src/minecraft/ml"/>
    <property name="build" value="build"/>
    <property name="dist" value="dist"/>
    <path id="JUnit.classpath">
        <pathelement location="JUnit4/junit.jar"/>
        <pathelement location="JUnit4/org.hamcrest.core_1.1.0.v20090501071000.jar"/>
    </path>
    <path id="Minecraft.classpath">
        <pathelement location="Referenced Libraries/forgeSrc-1.7.2-10.12.0.1034.jar"/>
        <pathelement location="Referenced Libraries/launchwrapper-1.9.jar"/>
        <pathelement location="Referenced Libraries/asm-debug-all-4.1.jar"/>
        <pathelement location="Referenced Libraries/scala-library-2.10.2.jar"/>
        <pathelement location="Referenced Libraries/scala-compiler-2.10.2.jar"/>
        <pathelement location="Referenced Libraries/jopt-simple-4.5.jar"/>
        <pathelement location="Referenced Libraries/vecmath-1.3.1.jar"/>
        <pathelement location="Referenced Libraries/trove4j-3.0.3.jar"/>
        <pathelement location="Referenced Libraries/icu4j-core-mojang-51.2.jar"/>
        <pathelement location="Referenced Libraries/Izma-0.0.1.jar"/>
        <pathelement location="Referenced Libraries/codecjorbis-20101023.jar"/>
        <pathelement location="Referenced Libraries/codecwav-20101023.jar"/>
        <pathelement location="Referenced Libraries/libraryjavasound-20101123.jar"/>
        <pathelement location="Referenced Libraries/librarylwjglopenal-20100824.jar"/>
        <pathelement location="Referenced Libraries/soundsystem-20120107.jar"/>
        <pathelement location="Referenced Libraries/netty-all-4.0.10.Final.jar"/>
        <pathelement location="Referenced Libraries/guava-15.0.jar"/>
        <pathelement location="Referenced Libraries/commons-lang3-3.1.jar"/>
        <pathelement location="Referenced Libraries/commons-io-2.4.jar"/>
        <pathelement location="Referenced Libraries/jinput-2.0.5.jar"/>
        <pathelement location="Referenced Libraries/jutils-1.0.0.jar"/>
        <pathelement location="Referenced Libraries/gson-2.2.4.jar"/>
        <pathelement location="Referenced Libraries/authlib-1.3.jar"/>
        <pathelement location="Referenced Libraries/log4j-api-2.0-beta9.jar"/>
        <pathelement location="Referenced Libraries/log4j-core-2.0-beta9.jar"/>
        <pathelement location="Referenced Libraries/lwjgl-2.9.0.jar"/>
        <pathelement location="Referenced Libraries/lwjgl_util-2.9.0.jar"/>
        <pathelement location="Referenced Libraries/lwjgl-platform-2.9.0-natives-linux.jar"/>
        <pathelement location="Referenced Libraries/lwjgl-platform-2.9.0-natives-osx.jar"/>
        <pathelement location="Referenced Libraries/lwjgl-platform-2.9.0-natives-windows.jar"/>
        <pathelement location="Referenced Libraries/lwjgl-platform-2.0.5-natives-linux.jar"/>
        <pathelement location="Referenced Libraries/lwjgl-platform-2.0.5-natives-osx.jar"/>
        <pathelement location="Referenced Libraries/lwjgl-platform-2.0.5-natives-windows.jar"/>
        <pathelement location="Referenced Libraries/scala-reflect-2.10.2.jar"/>
    </path>
    
    <target name="init">
        <mkdir dir="${build.main}"/>
        <mkdir dir="${build.test}"/>
        <mkdir dir="${build.resources}"/>
        
        <!-- Create the time stamp -->
            <tstamp/>
        
        <fileset dir="${src.main}">
            <exclude name="*.java"/>
        </fileset>
        
        <fileset dir="${src.test}">
            <exclude name="*.java"/>
        </fileset>
        
        <fileset dir="${src.resources}">
            <exclude name="*.java"/>
        </fileset>
    </target>
    
    <target depends="init" name="build">
        <javac debug="true" destdir="${build.main}" includeantruntime="false">
            <src path="${src.main}"/>
            <src path="${src.resources}"/>
            <classpath refid="Minecraft.classpath"/>
        </javac>
    </target>
    
    <target depends="build" name="buildTests">
        <javac debug="true" destdir="${build.main}" srcdir="${src}" includeantruntime="false">
            <src path="${src.test}"/>
                <classpath>
                    <path refid="Minecraft.classpath"/>
                    <path refid="JUnit.classpath"/>
                    <pathelement location="${build.test}"/>
                </classpath>
        </javac>
    </target>
    
    <target depends="buildTests" name="test">
        <mkdir dir="${junit.output.dir}"/>
        <junit haltonfailure="yes" fork="true" printsummary="on">
            <formatter type="xml"/>
            <batchtest todir="${junit.output.dir}">
                <fileset dir="${build.test}"></fileset>
            </batchtest>
            
            <classpath>
                <pathelement location="${build.test}"/>
                <pathelement location="${build.main}"/>
                <path refid="Minecraft.classpath"/>
                <path refid="JUnit.classpath"/>
            </classpath>
        </junit>
    </target>
    
    <target name="dist" depends="test">
        <mkdir dir="${dist}" />
        <jar destfile="${dist}/${MinecraftForgeVersion}-${DSTAMP}.jar">
            <fileset dir="${build.main}" />
            <fileset dir="${build.resources}" />
        </jar>
    </target>
    
    <target name="main" depends="test"/>
    <target name="clean" description="clean up">
        <!-- Delete the ${build},${dist} and directory trees -->
        <delete dir="${build}"/>
        <delete dir="${dist}"/>
    </target>
    
    <!-- Make the javadoc for the code-->
    <mkdir dir="${javadoc}"/>
    <javadoc
        destdir="${javadoc}"
        author="true"
        version="true"
        use="true"
        windowtitle="Test API">
        
        <fileset dir="src/main/java" defaultexcludes="yes">
            <include name="*.java"/>
        </fileset>
    </javadoc>
    
</project>